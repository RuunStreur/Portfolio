---
title: "Portfolio Computational Musicology 2022 - Ruun Streur"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    orientation: column
    vertical_layout: fill
    theme: 
      version: 4
      bootswatch: minty
---

```{r setup, include=FALSE}
# Setup
library(flexdashboard)
library(ggplot2)
library(plotly)
library(tidyverse)
library(spotifyr)
library(compmus)
library(gridExtra)
library(patchwork)
library(knitr)
library(kableExtra)
library(scales)
```


```{r}
# Loading Playlists
bowie <- get_playlist_audio_features("", "109zncLRngc5ofl1DsCHcE")
bowie_eno <- get_playlist_audio_features("", "6Rb67d7vVnq1FFAASwy5p5")
TH <- get_playlist_audio_features("", "1K27mtJcCFQw4IxJLZlmNQ")
TH_eno <- get_playlist_audio_features("", "4XrUACEdnQh8WfygAgSKxd")
bowie_disc <- get_playlist_audio_features("", "0mkz40ZahTeC6y2klc527h")

bowie_extracol <- bowie %>% add_column(is_eno = 0)
bowie_eno_extracol <- bowie_eno %>% add_column(is_eno = 1)
TH_extracol <- TH %>% add_column(is_eno = 0)
TH_eno_extracol <- TH_eno %>% add_column(is_eno = 1)
bowie_all <- bind_rows(bowie_extracol, bowie_eno_extracol)
TH_all <- bind_rows(TH_extracol, TH_eno_extracol)
```


```{r} 
# Plotting
limy_min <- 0
limy_max <- 385000

bowieSum <- bowie%>%
  group_by(track.album.name)%>%
  summarize(meanDance=mean(danceability), meanVal = mean(valence), meanTempo = mean(tempo), meanAc = mean(acousticness), meanInst = mean(instrumentalness),
            meanPop = mean(track.popularity), meanDur = mean(track.duration_ms)
            )

bowie_enoSum <- bowie_eno%>%
  group_by(track.album.name)%>%
  summarize(meanDance=mean(danceability), meanVal = mean(valence), meanTempo = mean(tempo), meanAc = mean(acousticness), meanInst = mean(instrumentalness),
            meanPop = mean(track.popularity), meanDur = mean(track.duration_ms)
            )

talkingSum <- TH%>%
  group_by(track.album.name)%>%
  summarize(meanDance=mean(danceability), meanVal = mean(valence), meanTempo = mean(tempo), meanAc = mean(acousticness), meanInst = mean(instrumentalness),
            meanPop = mean(track.popularity), meanDur = mean(track.duration_ms)
                        )

talking_enoSum <- TH_eno%>%
  group_by(track.album.name)%>%
  summarize(meanDance=mean(danceability), meanVal = mean(valence), meanTempo = mean(tempo), meanAc = mean(acousticness), meanInst = mean(instrumentalness),
            meanPop = mean(track.popularity), meanDur = mean(track.duration_ms)
                        )

############################################################################################################################################################

bowieplot <- ggplot(bowieSum, aes(track.album.name, meanDur, color=track.album.name, fill=track.album.name)) + geom_col() + ylim(limy_min, limy_max) + 
  theme_light() +
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) +
  labs(
    title = "The mean duration in in four non-Eno produced Bowie Albums",
    x='Album',
    y= 'Duration in ms'
  )

bowie_enoplot <- ggplot(bowie_enoSum, aes(track.album.name, meanDur, color=track.album.name, fill=track.album.name)) + geom_col() + ylim(limy_min, limy_max) + 
  theme_light() +
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
labs(
  title = "The mean duration in in Bowie's Berlin Trilogy",
  x='Album',
  y= 'Duration in ms'
)

talkingplot <- ggplot(talkingSum, aes(track.album.name, meanDur, color=track.album.name, fill=track.album.name)) + geom_col() + ylim(limy_min, limy_max) + 
  theme_light() +
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  labs(
    title = "The mean duration in three non-Eno produced Talking Heads albums",
    x='Album',
    y= 'Duration in ms'
  )

talking_enoplot <- ggplot(talking_enoSum, aes(track.album.name, meanDur, color=track.album.name, fill=track.album.name)) + geom_col()+ ylim(limy_min, limy_max) + 
  theme_light() +
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  labs(
    title = "The mean duration in three Eno produced Talking Heads albums",
    x='Album',
    y= 'Duration in ms'
  )
```

```{r}

bowie_discSum <- bowie_disc%>%
  group_by(track.album.name)%>%
  summarize(meanDance=mean(danceability), meanVal = mean(valence))

bowie_discplot <- ggplot(bowie_discSum, aes(x=reorder(track.album.name, meanDance), meanDance, color=track.album.name, fill=track.album.name)) + geom_col() + 
  theme_light() +
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) +
  labs(
    title = "The mean danceability in all of Bowie's albums",
    x='Album',
    y= 'Mean danceability'
  )

bowie_lollipop <- ggplot(bowie_discSum, aes(x=reorder(track.album.name, meanDance), y=meanDance)) + theme_light() +
  geom_point(size=3) + 
  geom_segment(aes(x=track.album.name, 
                   xend=track.album.name, 
                   y=0, 
                   yend=meanDance)) + 
  labs(title="Bowie's biggest swingers", 
       subtitle="Average Danceability for every bowie album", 
       caption="source: Spotify API") + 
  theme(axis.text.x = element_text(angle=80, vjust=0.5),
        axis.ticks.x=element_blank())

```
-----------------------------------------------------------------------

### The fingerprints of Brian Eno in David Bowie's and The Talking Heads's work; an introduction to the corpus.


<b><font size="8em"> Introduction </font></b>
<b><font size="4em"> 


When thinking of a popular band or record, we mostly think about the charismatic lead singer, virtuous guitarist or energetic drummer. Overlooked however is often the role of the producer of the band. It is not without reason that George Martin is often called 'the fifth Beatle'. How much influence do producers have on a bands sound? How much does a record producers put their own style into the records they produce? Of course this will vary a lot from producer to producer, but for this Portfolio the work of one producer in particular will be highlighted: Brian Eno. Eno is regarded as one of the best producers in the history of record producers and has produced for names as Talking Heads, Roxy Music and U2. With fellow producer Tony Visconte he helped David Bowie create his famed 'Berlin Trilogy', existing of 'Low', 'Heroes' and 'Lodger', which this Portfolio will analyse and investigate. Next to Bowie's Berlin Trilogy we will look at another trilogy Eno has produced: Talking Heads's 'More songs about buildings and food', 'Fear of Music' and 'Remain in Light'. Can we find notable differences within Eno and non-Eno produced records? Are there correlations between his work with Bowie and Talking Heads?

Corpus

David Bowie's 'Berlin Trilogy' versus other work by Bowie ('Diamond Dogs', 'Hunky Dory', 'Let's Dance', 'Station to Station').

Talking Heads 'More songs about buildings and food', 'Fear of Music' and 'Remain in Light' versus 'Talking Heads 77'', 'Speaking in Tongues' and 'Little Creatures'</font></b>

```{r}
tab <- knitr::kable(bowie[1:5,6:15], format="markdown",caption = "A couple of features for a couple of David Bowie's songs")
tab
```

### Did Bowie change anything else when switching languages for Heroes? A dynamic time warping analysis.
```{r}

heroes <-
  get_tidy_audio_analysis("5Ci3b8pfpLA9Zk17qGXBCF") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)

helden <-
  get_tidy_audio_analysis("7dCiqEHU97OX7mkRG1Kdjm") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)

compmus_long_distance(
  heroes %>% mutate(pitches = map(pitches, compmus_normalise, "manhattan")),
  helden %>% mutate(pitches = map(pitches, compmus_normalise, "manhattan")),
  feature = pitches,
  method = "manhattan"
) %>%
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "Heroes", y = "Helden") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)

```


***
<font size="4em"> Here we see a dynamic time warping analysis of David Bowie's two versions of his song 'Heroes'. On the X-axis 'Heroes' is plotted, while on the Y-axis his German version 'Helden' is plotted. We see a clear correlation between the two, some small discrepancies could be formed due to there being a 3 second change in duration between the two songs. We can see that 'Helden' is a bit longer at the top of the graph! there is no overlap. \n  Since the two versions are found to be so similar, we won't take Bowie's German version into account in future analyses.</font>

-----------------------------------------------------------------------

### Does Eno affect the average duration of the albums he works on?

```{r static_plot, fig.width=14, fig.height=10}
grid.arrange(bowie_enoplot, bowieplot, talking_enoplot, talkingplot, ncol=2)
```

***
<font size="4em"> As we can see from the graphs, albums that are not produced by Eno (on the right) have a slightly longer average song duration. </font>

-----------------------------------------------------------------------

### Is Bowie's most danceable album actually 'Let's Dance'?

```{r, fig.width=14, fig.height=10}
ggplotly(bowie_lollipop)
```

***
<font size="4em"> A little bit of a detour, but after I found out that of all albums in my corpus, Bowie's 'Let's Dance' has the highest mean danceability, I wanted to know how it ranked among all of his work. As we see that of all his albums it ranks at number 4, right after 'Tonight' and the two studio versions of 'Never Let Me'. It turns out the Japanese version of 'Never Let Me' is the grooviest of all, those lucky Japanese!</font>

-----------------------------------------------------------------------

### Does Eno make songs more sad?

```{r}
theme_set(theme_light())

bowieSum <- bowie%>%
  summarize(meanVal = mean(danceability)) %>% add_column(is_eno = 0, artist = 'bowie')
bowie_enoSum <- bowie_eno%>%
  summarize(meanVal = mean(danceability)) %>% add_column(is_eno = 1, artist = 'bowie')
THSum <- TH%>%
  summarize(meanVal = mean(danceability)) %>% add_column(is_eno = 0, artist = 'TH')
TH_enoSum <- TH_eno%>%
  summarize(meanVal = mean(danceability)) %>% add_column(is_eno = 1, artist = 'TH')
all_sum1 <- bind_rows(bowieSum, bowie_enoSum, THSum, TH_enoSum)

bowie_val <- subset(all_sum1, artist=="bowie" & is_eno=="0")$meanVal
bowie_eno_val <- subset(all_sum1, artist=="bowie" & is_eno=="1")$meanVal
TH_val <- subset(all_sum1, artist=="TH" & is_eno=="0")$meanVal
TH_eno_val <- subset(all_sum1, artist=="TH" & is_eno=="1")$meanVal

bowieval <- data.frame(artist = 'David Bowie', without_eno = bowie_val, with_eno = bowie_eno_val)
THval <- data.frame(artist = 'Talking Heads', without_eno = TH_val, with_eno = TH_eno_val)
all_sum <- bind_rows(bowieval, THval)

colnames(all_sum) <- c("artist", "without_eno", "with_eno")
left_label <- paste(all_sum$artist, round(all_sum$`without_eno`, digits = 2),sep=", ")
right_label <- paste(all_sum$artist, round(all_sum$`with_eno`, digits = 2),sep=", ")
all_sum$class <- ifelse((all_sum$`with_eno` - all_sum$`without_eno`) < 0, "red", "green")

plotDance <- ggplot(all_sum) + geom_segment(aes(x=1, xend=2, y=`without_eno`, yend=`with_eno`, col=class), size=.75, show.legend=F) + 
  geom_vline(xintercept=1, linetype="dashed", size=.1) + 
  geom_vline(xintercept=2, linetype="dashed", size=.1) +
  scale_color_manual(labels = c("Up", "Down"), 
                     values = c("green"="#00ba38", "red"="#f8766d")) +
  labs(x="", y="Mean danceability") +  # Axis labels
  xlim(.5, 2.5) + ylim(0.4,(1.1*(max(all_sum$`without_eno`, all_sum$`with_eno`))))

plotDance<- plotDance+ geom_text(label=left_label, y=all_sum$`without_eno`, x=rep(1, NROW(all_sum)), hjust=1.1, size=4)
plotDance<- plotDance+ geom_text(label=right_label, y=all_sum$`with_eno`, x=rep(2, NROW(all_sum)), hjust=-0.1, size=4)
plotDance<- plotDance+ geom_text(label="Without Eno", color='gray25', x=1, y=1.1*(max(all_sum$`without_eno`, all_sum$`with_eno`)), hjust=1.2, size=5)
plotDance<- plotDance+ geom_text(label="With Eno", color='gray25', x=2, y=1.1*(max(all_sum$`without_eno`, all_sum$`with_eno`)), hjust=-0.1, size=5)

plotDance<- plotDance+ theme(axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          plot.margin = unit(c(1,2,1,2), "cm")) +
  labs(
    title = '1. The mean danceability of Eno vs. non-Eno produced albums'
  )

#####################################################################################################################################################
bowieSum <- bowie%>%
  summarize(meanVal = mean(valence)) %>% add_column(is_eno = 0, artist = 'bowie')
bowie_enoSum <- bowie_eno%>%
  summarize(meanVal = mean(valence)) %>% add_column(is_eno = 1, artist = 'bowie')
THSum <- TH%>%
  summarize(meanVal = mean(valence)) %>% add_column(is_eno = 0, artist = 'TH')
TH_enoSum <- TH_eno%>%
  summarize(meanVal = mean(valence)) %>% add_column(is_eno = 1, artist = 'TH')
all_sum1 <- bind_rows(bowieSum, bowie_enoSum, THSum, TH_enoSum)

bowie_val <- subset(all_sum1, artist=="bowie" & is_eno=="0")$meanVal
bowie_eno_val <- subset(all_sum1, artist=="bowie" & is_eno=="1")$meanVal
TH_val <- subset(all_sum1, artist=="TH" & is_eno=="0")$meanVal
TH_eno_val <- subset(all_sum1, artist=="TH" & is_eno=="1")$meanVal

bowieval <- data.frame(artist = 'David Bowie', without_eno = bowie_val, with_eno = bowie_eno_val)
THval <- data.frame(artist = 'Talking Heads', without_eno = TH_val, with_eno = TH_eno_val)
all_sum <- bind_rows(bowieval, THval)

colnames(all_sum) <- c("artist", "without_eno", "with_eno")
left_label <- paste(all_sum$artist, round(all_sum$`without_eno`, digits = 2),sep=", ")
right_label <- paste(all_sum$artist, round(all_sum$`with_eno`, digits = 2),sep=", ")
all_sum$class <- ifelse((all_sum$`with_eno` - all_sum$`without_eno`) < 0, "red", "green")

plotValence <- ggplot(all_sum) + geom_segment(aes(x=1, xend=2, y=`without_eno`, yend=`with_eno`, col=class), size=.75, show.legend=F) + 
  geom_vline(xintercept=1, linetype="dashed", size=.1) + 
  geom_vline(xintercept=2, linetype="dashed", size=.1) +
  scale_color_manual(labels = c("Up", "Down"), 
                     values = c("green"="#00ba38", "red"="#f8766d")) +
  labs(x="", y="Mean valence") +  # Axis labels
  xlim(.5, 2.5) + ylim(0.4,(1.1*(max(all_sum$`without_eno`, all_sum$`with_eno`))))

plotValence<- plotValence+ geom_text(label=left_label, y=all_sum$`without_eno`, x=rep(1, NROW(all_sum)), hjust=1.1, size=4)
plotValence<- plotValence+ geom_text(label=right_label, y=all_sum$`with_eno`, x=rep(2, NROW(all_sum)), hjust=-0.1, size=4)
plotValence<- plotValence+ geom_text(label="Without Eno", color='gray25', x=1, y=1.1*(max(all_sum$`without_eno`, all_sum$`with_eno`)), hjust=1.2, size=5) 
plotValence<- plotValence+ geom_text(label="With Eno", color='gray25', x=2, y=1.1*(max(all_sum$`without_eno`, all_sum$`with_eno`)), hjust=-0.1, size=5)

plotValence<- plotValence+ theme(axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          plot.margin = unit(c(1,2,1,2), "cm")) +
  labs(
    title = '2. The mean valence of Eno vs. non-Eno produced albums'
  )


#####################################################################################################################################################
bowieSum <- bowie%>%
  summarize(meanVal = mean(tempo)) %>% add_column(is_eno = 0, artist = 'bowie')
bowie_enoSum <- bowie_eno%>%
  summarize(meanVal = mean(tempo)) %>% add_column(is_eno = 1, artist = 'bowie')
THSum <- TH%>%
  summarize(meanVal = mean(tempo)) %>% add_column(is_eno = 0, artist = 'TH')
TH_enoSum <- TH_eno%>%
  summarize(meanVal = mean(tempo)) %>% add_column(is_eno = 1, artist = 'TH')
all_sum1 <- bind_rows(bowieSum, bowie_enoSum, THSum, TH_enoSum)

bowie_val <- subset(all_sum1, artist=="bowie" & is_eno=="0")$meanVal
bowie_eno_val <- subset(all_sum1, artist=="bowie" & is_eno=="1")$meanVal
TH_val <- subset(all_sum1, artist=="TH" & is_eno=="0")$meanVal
TH_eno_val <- subset(all_sum1, artist=="TH" & is_eno=="1")$meanVal

bowieval <- data.frame(artist = 'David Bowie', without_eno = bowie_val, with_eno = bowie_eno_val)
THval <- data.frame(artist = 'Talking Heads', without_eno = TH_val, with_eno = TH_eno_val)
all_sum <- bind_rows(bowieval, THval)

colnames(all_sum) <- c("artist", "without_eno", "with_eno")
left_label <- paste(all_sum$artist, round(all_sum$`without_eno`),sep=", ")
right_label <- paste(all_sum$artist, round(all_sum$`with_eno`),sep=", ")
all_sum$class <- ifelse((all_sum$`with_eno` - all_sum$`without_eno`) < 0, "red", "green")

plotTempo <- ggplot(all_sum) + geom_segment(aes(x=1, xend=2, y=`without_eno`, yend=`with_eno`, col=class), size=.75, show.legend=F) + 
  geom_vline(xintercept=1, linetype="dashed", size=.1) + 
  geom_vline(xintercept=2, linetype="dashed", size=.1) +
  scale_color_manual(labels = c("Up", "Down"), 
                     values = c("green"="#00ba38", "red"="#f8766d")) +
  labs(x="", y="Mean Tempo") +  # Axis labels
  xlim(.5, 2.5) + ylim(105,(1.1*(max(all_sum$`without_eno`, all_sum$`with_eno`))))

plotTempo<- plotTempo+ geom_text(label=left_label, y=all_sum$`without_eno`, x=rep(1, NROW(all_sum)), hjust=1.1, size=4)
plotTempo<- plotTempo+ geom_text(label=right_label, y=all_sum$`with_eno`, x=rep(2, NROW(all_sum)), hjust=-0.1, size=4)
plotTempo<- plotTempo+ geom_text(label="Without Eno", color='gray25', x=1, y=1.1*(max(all_sum$`without_eno`, all_sum$`with_eno`)), hjust=1.2, size=5)  # title
plotTempo<- plotTempo+ geom_text(label="With Eno", color='gray25', x=2, y=1.1*(max(all_sum$`without_eno`, all_sum$`with_eno`)), hjust=-0.1, size=5)  # title

plotTempo<- plotTempo+ theme(axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          plot.margin = unit(c(1,2,1,2), "cm")) +
  labs(
    title = '3. The mean tempo of Eno vs. non-Eno produced albums'
  )


#####################################################################################################################################################
bowieSum <- bowie%>%
  summarize(meanVal = mean(energy)) %>% add_column(is_eno = 0, artist = 'bowie')
bowie_enoSum <- bowie_eno%>%
  summarize(meanVal = mean(energy)) %>% add_column(is_eno = 1, artist = 'bowie')
THSum <- TH%>%
  summarize(meanVal = mean(energy)) %>% add_column(is_eno = 0, artist = 'TH')
TH_enoSum <- TH_eno%>%
  summarize(meanVal = mean(energy)) %>% add_column(is_eno = 1, artist = 'TH')
all_sum1 <- bind_rows(bowieSum, bowie_enoSum, THSum, TH_enoSum)

bowie_val <- subset(all_sum1, artist=="bowie" & is_eno=="0")$meanVal
bowie_eno_val <- subset(all_sum1, artist=="bowie" & is_eno=="1")$meanVal
TH_val <- subset(all_sum1, artist=="TH" & is_eno=="0")$meanVal
TH_eno_val <- subset(all_sum1, artist=="TH" & is_eno=="1")$meanVal

bowieval <- data.frame(artist = 'David Bowie', without_eno = bowie_val, with_eno = bowie_eno_val)
THval <- data.frame(artist = 'Talking Heads', without_eno = TH_val, with_eno = TH_eno_val)
all_sum <- bind_rows(bowieval, THval)

colnames(all_sum) <- c("artist", "without_eno", "with_eno")
left_label <- paste(all_sum$artist, round(all_sum$`without_eno`, digits = 2),sep=", ")
right_label <- paste(all_sum$artist, round(all_sum$`with_eno`, digits = 2), sep=", ")
all_sum$class <- ifelse((all_sum$`with_eno` - all_sum$`without_eno`) < 0, "red", "green")

plotEnergy <- ggplot(all_sum) + geom_segment(aes(x=1, xend=2, y=`without_eno`, yend=`with_eno`, col=class), size=.75, show.legend=F) + 
  geom_vline(xintercept=1, linetype="dashed", size=.1) + 
  geom_vline(xintercept=2, linetype="dashed", size=.1) +
  scale_color_manual(labels = c("Up", "Down"), 
                     values = c("green"="#00ba38", "red"="#f8766d")) +
  labs(x="", y="Mean Energy") +  # Axis labels
  xlim(.5, 2.5) + ylim(0.4,(1.1*(max(all_sum$`without_eno`, all_sum$`with_eno`))))

plotEnergy<- plotEnergy+ geom_text(label=left_label, y=all_sum$`without_eno`, x=rep(1, NROW(all_sum)), hjust=1.1, size=4)
plotEnergy<- plotEnergy+ geom_text(label=right_label, y=all_sum$`with_eno`, x=rep(2, NROW(all_sum)), hjust=-0.1, size=4)
plotEnergy<- plotEnergy+ geom_text(label="Without Eno", color='gray25', x=1, y=1.1*(max(all_sum$`without_eno`, all_sum$`with_eno`)), hjust=1.2, size=5)  # title
plotEnergy<- plotEnergy+ geom_text(label="With Eno", color='gray25', x=2, y=1.1*(max(all_sum$`without_eno`, all_sum$`with_eno`)), hjust=-0.1, size=5)  # title

plotEnergy<- plotEnergy+ theme(axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          plot.margin = unit(c(1,2,1,2), "cm")) +
  labs(
    title = '4. The mean energy of Eno vs. non-Eno produced albums'
  )

```

```{r, fig.width=20, fig.height=10}
grid.arrange(plotDance, plotValence, plotTempo, plotEnergy, ncol=2)

```

***
<font size="4em"> After finding out that Let's Dance is, who would've thought, very danceable I wanted to know what applying a whiff of Eno to your production does for the average danceability, and related attributes of your album.\n

In the top left we can see a drop in danceability in the albums which Eno has produced compared to the ones he hasn't. It also turns out that the average valence decreases. Does that mean that the albums on which Eno has worked are slower and contain less energy? No! As we see in graphs 3 and four, the mean Tempo and mean energy do not decrease in Eno's albums, they increase if anything.

What attributes lowers the average danceability and valence if it's not the tempo or the energy?
</font>

### Conclusion/Discussion
<b><font size="8em"> Conclusion </font></b>

To be written!
